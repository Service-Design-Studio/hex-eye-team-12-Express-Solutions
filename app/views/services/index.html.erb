  <div class="container">
    <% if session[:branch] != nil %>
      <h6 class="subtitle"><%=Branch.find_by(branch: session[:branch]).branch_name%></h6>
    <% end %>
  <div class="dropdown-container" id="search">
    <h6 class="title is-3 has-text-left">What are you looking for?</h6>  
    <input class="input is-rounded" type="text" placeholder="ðŸ” Search for a service" id="myInput" onkeyup="check_timeout()">  
    <div class="dropdown display" id="results" style="display: none">
      <a id="1"></a>
      <a id="2"></a>
      <a id="3"></a>
      <a id="4"></a>
      <a id="5"></a>

    </div>
  </div>
  <br>
  <br>


  
  <div class="container">
    <h3 class="title is-2 has-text-left">Top Services</h3>
  </div>
  <br>

  <div class="columns is-mobile is-multiline">

    <% @topServices.each do |service| %>

    <% the_link = time_estimate_url(service) %>
    <% the_services = service.service %>
    <% the_services = '' + the_services + '' %>
        
      <div class="column is-half" id= <%= service.service %>> 

        <div class="card-image">
          <figure class="image is-3by1">
            <%= image_tag 'GreyBackground.png' %>
          </figure>
              <a href=<%= the_link %>>
                <div class="is-overlay centertext">
                    <center><p><%= the_services %></p></center>
                </div>
              </a>   
        </div>

      </div>
    <% end %>
  </div>

  <div class="container">
    <h3 class="title is-2 has-text-left">Main Categories</h3>
  </div>
  <br>

  <div class="columns is-mobile is-multiline">

    <% @allServices.each do |service| %>

    <% the_link2 = sub_services_url(service.category) %>
    <% the_services2 = service.category %>

      <div class="column is-half"> 

        <div class="card-image">
          <figure class="image is-3by1">
            <%= image_tag 'GreyBackground.png' %>
          </figure>

          <a href=<%= the_link2 %>>
            <div class="is-overlay centertext">
                <center><p><%= the_services2 %></p></center>   
            </div>
          </a>
        </div>
      </div>
    <% end %>
  </div>
  <br>


  <button class="button" id="More"><%= link_to "More", more_services_path() %></button>
  <script>
  var timeout = null;
  function check_timeout() {
    clearTimeout(timeout);
    timeout = setTimeout(filterFunction(), 10000);
  }
  async function filterFunction() {
 
  var input, filter, div, a
  
  input = document.getElementById("myInput");
  filter = input.value.toUpperCase();
  div = document.getElementById("results");
 setInterval(function() {
    if(input=== document.activeElement) {
        div.style.display = "block";
        console.log('set to block')
        if (input.value.length < 3) {
          div.style.display = "none";
        
  }
    } else {
        div.style.display = "none";
        console.log('set to none')
    }
}, 1000);

  searchDict =  await query(input.value);
  // console.log(searchDict);
  id = searchDict["top_5_index"];
  services = searchDict['top_5_services'];
  // console.log(services);
  
    for (i = 0; i < 5; i++) {
      index = String(i);
      service = services[i];
      a = document.getElementById(String(i+1));
      a.innerText = service;
      a.href = `services/${id[i]+2}/time_estimate`;
    }
}

function query(inp) {
  // implement getrequest 
  return fetch('http://127.0.0.1:5000/predict?query='+inp)
  .then(response => response.json());
}



</script>
