<<<<<<< HEAD
  <div class="container">
    <% if session[:branch] != nil %>
      <h6 class="subtitle"><%=Branch.find_by(branch: session[:branch]).branch_name%></h6>
    <% end %>

=======


  <div class="dropdown-container" id="search">
>>>>>>> ef0447f (search bar wip 1)
    <h6 class="title is-3 has-text-left">What are you looking for?</h6>  
    <input class="input is-rounded" type="text" placeholder="🔍 Search for a service" id="myInput" onkeyup="filterFunction()">  
    <div class="dropdown display" id="results">
      <%# <li id="1"></li>
      <li id="2"></li>
      <li id="3"></li>
      <li id="4"></li>
      <li id="5"></li> %>

    </div>
  </div>
  <br>
  <br>


  
  <div class="container">
    <h3 class="title is-2 has-text-left">Top Services</h3>
  </div>
  <br>

  <div class="columns is-mobile is-multiline">

    <% @topServices.each do |service| %>

    <% the_link = time_estimate_url(service) %>
    <% the_services = service.service %>
    <% the_services = '' + the_services + '' %>
        
      <div class="column is-half" id= <%= service.service %>> 

        <div class="card-image">
          <figure class="image is-3by1">
            <%= image_tag 'GreyBackground.png' %>
          </figure>
              <a href=<%= the_link %>>
                <div class="is-overlay centertext">
                    <center><p><%= the_services %></p></center>
                </div>
              </a>   
        </div>

      </div>
    <% end %>
  </div>

  <div class="container">
    <h3 class="title is-2 has-text-left">Main Categories</h3>
  </div>
  <br>

  <div class="columns is-mobile is-multiline">

<<<<<<< HEAD
    <% @allServices.each do |service| %>
=======
    <!%=  @allServices.where(id: 3)[0].service %>

    <% @allCategories.each do |service| %>
>>>>>>> c1e3ff3 (set up AI enable search)

    <% the_link2 = sub_services_url(service.category) %>
    <% the_services2 = service.category %>

      <div class="column is-half"> 

        <div class="card-image">
          <figure class="image is-3by1">
            <%= image_tag 'GreyBackground.png' %>
          </figure>

          <a href=<%= the_link2 %>>
            <div class="is-overlay centertext">
                <center><p><%= the_services2 %></p></center>   
            </div>
          </a>
        </div>
      </div>
    <% end %>
  </div>
  <br>


  <button class="button" id="More"><%= link_to "More", more_services_path() %></button>
  <script>


  
  async function filterFunction() {
 
  var input, filter, ul, li, a, i;
  
  input = document.getElementById("myInput");
  filter = input.value.toUpperCase();
  div = document.getElementById("results");

  //Clear dropdown a
    cleardropdown('results');

    searchDict =  await query(document.getElementById("myInput").value);
    console.log(searchDict);
    id = searchDict["top_5_index"];
    services = searchDict['top_5_services'];
    console.log(services);
  
    for (i = 0; i < 5; i++) {
      index = String(i);
      service = services[i];
      console.log("Service: ",service);
      // a = document.getElementById(index);
      // console.log(a);
      // a.innerText = service;
      a = document.createElement("a");
      a.innerText = service;
      console.log(`services/${id[i]+2}/time_estimate`);
      a.href = `services/${id[i]+2}/time_estimate`;
      //create attributes and set value
      a.setAttribute("id", id[i]);
      div.appendChild(a);
    }

    refreshdropdown('results');

    if (document.getElementById("myInput").value == "") {
      cleardropdown('results');
    }
}


function sleep(ms) {
  return new Promise(
    resolve => setTimeout(resolve, ms)
  );
}


function query(inp) {
  // implement getrequest 
  return fetch('http://127.0.0.1:5000/predict?query='+inp)
  .then(response => response.json());
  // .then(data => console.log(data));
  // return {'top_5_index': [1,2,3,4,5], 'top_5_services': ['Service 1', 'Service 2', 'Service 3', 'Service 4', 'Service 5']};
}

function cleardropdown(id) {
  div = document.getElementById(id);
  while (div.children.length > 0) {
    div.removeChild(div.firstChild);
  }
}

function refreshdropdown(id) {
  div = document.getElementById(id);
  while (div.children.length > 5) {
    div.removeChild(div.firstChild);
  }
}


</script>